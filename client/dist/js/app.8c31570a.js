(()=>{"use strict";var e={366:(e,t,n)=>{n(3792),n(3362),n(9085),n(9391);var r=n(5471),a=function(){var e=this,t=e._self._c;return t("router-view")},o=[];const i={name:"App"},s=i;var u=n(1656),c=(0,u.A)(s,a,o,!1,null,null,null);const l=c.exports;var d=n(173),v=(n(113),n(5276),n(8111),n(116),n(6099),function(){var e=this,t=e._self._c;return t("div",{staticClass:"wrap"},[t("h1",[e._v("Проверка авто по VIN")]),t("div",{staticClass:"vin-box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.vin,expression:"vin"}],attrs:{placeholder:"Введите VIN"},domProps:{value:e.vin},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.find.apply(null,arguments)},input:function(t){t.target.composing||(e.vin=t.target.value)}}}),t("button",{on:{click:e.find}},[e._v("Найти")])]),e.loading?t("div",{staticClass:"hint"},[e._v("Поиск...")]):e._e(),e.error?t("div",{staticClass:"error"},[e._v(e._s(e.error))]):e._e(),e.car?t("div",{staticClass:"result"},[t("CarCard",{attrs:{item:e.car}}),t("div",{staticClass:"map"},[t("YandexMap",{attrs:{location:e.car.location}})],1)],1):e._e()])}),m=[],p=n(9217),f=n(4634),h=(n(2762),n(4335)),b=h.A.create({baseURL:"http://localhost:5000/api"});b.interceptors.request.use(function(e){var t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e});const _=b;var g=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card"},[t("div",{staticClass:"row"},[t("strong",[e._v("Make/Model:")]),e._v(" "+e._s(e.item.makeModel))]),t("div",{staticClass:"row"},[t("strong",[e._v("Year:")]),e._v(" "+e._s(e.item.year))]),t("div",{staticClass:"row"},[t("strong",[e._v("VIN:")]),e._v(" "+e._s(e.item.vin))]),t("div",{staticClass:"row"},[t("strong",[e._v("Invoice #:")]),e._v(" "+e._s(e.item.invoiceNumber))]),t("div",{staticClass:"row"},[t("strong",[e._v("Condition:")]),e._v(" "+e._s(e.prettyCondition(e.item.condition)))]),t("div",{staticClass:"row"},[t("strong",[e._v("Location:")]),e._v(" "+e._s(e.item.location))])])},w=[];const y={name:"CarCard",props:{item:{type:Object,required:!0}},methods:{prettyCondition:function(e){return"in_transit"===e?"in transit":"registration"}}},k=y;var C=(0,u.A)(k,g,w,!1,null,"8cccbcb8",null);const A=C.exports;var x=function(){var e=this,t=e._self._c;return t("div",{staticClass:"map-wrap"},[t("div",{staticClass:"legend"},[t("div",{staticClass:"legend-top"},[t("div",{staticClass:"progress"},[t("div",{staticClass:"bar",style:{width:e.progressPercent+"%"}})]),t("div",{staticClass:"steps"},e._l(e.steps,function(n,r){return t("div",{key:n.key,staticClass:"step"},[t("div",{staticClass:"dot",class:{passed:r<=e.currentIdx}},[e._v(" "+e._s(r+1)+" ")]),t("div",{staticClass:"label"},[e._v(e._s(n.label))])])}),0)])]),t("div",{ref:"map",staticClass:"ymap"})])},M=[],P=n(5923);n(8706),n(8980),n(1629),n(2062),n(4114),n(4782),n(7588),n(1701),n(3500),n(6031);const j={name:"YandexMap",props:{location:{type:String,default:""}},data:function(){return{map:null,ymapsReady:!1,objects:[],steps:[{key:"warehouse",label:"Warehouse",coord:[43.25667,76.92861]},{key:"Khorgos",label:"Khorgos",coord:[44.212,80.414]},{key:"Kazakhstan terminal",label:"KZ terminal (Astana)",coord:[51.16939,71.44907]},{key:"Kazakhstan-Russian Federation customs post",label:"KZ-RF customs",coord:[54.87578,69.16299]},{key:"Minsk",label:"Minsk",coord:[53.90228,27.56188]}]}},computed:{currentIdx:function(){var e=this,t=this.steps.findIndex(function(t){return t.key===e.location});return t<0?-1:t},progressPercent:function(){if(this.currentIdx<0)return 0;var e=this.steps.length-1;return Math.min(100,Math.round(this.currentIdx/e*100))}},mounted:function(){this.initMap()},watch:{location:function(){this.drawRoute()}},methods:{initMap:function(){var e=this;return(0,f.A)((0,p.A)().m(function t(){return(0,p.A)().w(function(t){while(1)switch(t.n){case 0:return t.n=1,e.ensureScript();case 1:window.ymaps.ready(function(){e.ymapsReady=!0,e.map=new window.ymaps.Map(e.$refs.map,{center:[53.9,27.56],zoom:5,controls:["zoomControl"]}),e.drawRoute()});case 2:return t.a(2)}},t)}))()},ensureScript:function(){return new Promise(function(e,t){if(window.ymaps)return e();var n="d5b49d70-84b5-459c-8a15-87f2bfb02f5f",r="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=".concat(n,"&load=package.full"),a=document.createElement("script");a.src=r,a.async=!0,a.onload=e,a.onerror=t,document.head.appendChild(a)})},clearObjects:function(){var e=this;this.map&&(this.objects.forEach(function(t){return e.map.geoObjects.remove(t)}),this.objects=[])},fitToAllPoints:function(e){if(null!==e&&void 0!==e&&e.length){var t=e[0][0],n=e[0][0],r=e[0][1],a=e[0][1];e.forEach(function(e){var o=(0,P.A)(e,2),i=o[0],s=o[1];t=Math.min(t,i),n=Math.max(n,i),r=Math.min(r,s),a=Math.max(a,s)});try{this.map.setBounds([[t,r],[n,a]],{checkZoomRange:!0,duration:300,zoomMargin:40})}catch(o){}}},drawFallbackLine:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new window.ymaps.Polyline(e,{},{strokeColor:t,strokeWidth:n,strokeStyle:r?"dash":"solid"});return this.map.geoObjects.add(a),this.objects.push(a),a},drawRoute:function(){var e,t,n=this;if(this.map&&this.ymapsReady){var r=window.ymaps;this.clearObjects();var a=this.steps.map(function(e){return e.coord});this.fitToAllPoints(a);var o,i=r.templateLayoutFactory.createClass('<div style="\n          width:28px;height:28px;border-radius:14px;\n          display:flex;align-items:center;justify-content:center;\n          font-size:13px;font-weight:700;color:#08110a;\n          background:$[properties.bgColor];\n          border:1px solid rgba(0,0,0,0.35);\n          box-shadow:0 0 0 3px $[properties.ringColor];\n        ">$[properties.num]</div>');if(null!==(e=r.multiRouter)&&void 0!==e&&e.MultiRoute?(o=new r.multiRouter.MultiRoute({referencePoints:a,params:{routingMode:"auto"}},{boundsAutoApply:!1,viaPointVisible:!1,wayPointVisible:!1,routeActiveStrokeColor:"#6b7280",routeActiveStrokeWidth:6,routeStrokeColor:"#6b7280",routeStrokeWidth:6}),this.map.geoObjects.add(o),this.objects.push(o)):this.drawFallbackLine(a,"#6b7280",4,!0),this.currentIdx>=1){var s,u=a.slice(0,this.currentIdx+1);if(null!==(s=r.multiRouter)&&void 0!==s&&s.MultiRoute){var c=new r.multiRouter.MultiRoute({referencePoints:u,params:{routingMode:"auto"}},{boundsAutoApply:!1,viaPointVisible:!1,wayPointVisible:!1,routeActiveStrokeColor:"#22c55e",routeActiveStrokeWidth:7,routeStrokeColor:"#22c55e",routeStrokeWidth:7});this.map.geoObjects.add(c),this.objects.push(c)}else this.drawFallbackLine(u,"#22c55e",5,!1)}if(this.steps.forEach(function(e,t){var a=n.currentIdx>=0&&t<=n.currentIdx,o=new r.Placemark(e.coord,{num:String(t+1),bgColor:a?"#22c55e":"#6b7280",ringColor:a?"rgba(34,197,94,0.35)":"rgba(107,114,128,0.25)",hintContent:"".concat(t+1,". ").concat(e.label)},{iconLayout:i,iconShape:{type:"Circle",coordinates:[14,14],radius:14}});n.map.geoObjects.add(o),n.objects.push(o)}),null!==(t=o)&&void 0!==t&&t.model){var l=function(){try{var e=o.getBounds();e&&n.map.setBounds(e,{checkZoomRange:!0,duration:300,zoomMargin:40})}catch(t){}};o.model.events.once("requestsuccess",l),o.model.events.once("requestfail",function(){}),setTimeout(l,800)}}}}},S=j;var I=(0,u.A)(S,x,M,!1,null,"7f5b80e2",null);const O=I.exports,N={name:"UserPage",components:{CarCard:A,YandexMap:O},data:function(){return{vin:"",car:null,loading:!1,error:""}},computed:{},methods:{find:function(){var e=this;return(0,f.A)((0,p.A)().m(function t(){var n,r,a,o,i;return(0,p.A)().w(function(t){while(1)switch(t.p=t.n){case 0:if(e.error="",e.car=null,n=(e.vin||"").trim(),n){t.n=1;break}return e.error="Введите VIN",t.a(2);case 1:return e.loading=!0,t.p=2,t.n=3,_.get("/public/car",{params:{vin:n}});case 3:r=t.v,a=r.data,e.car=a,t.n=5;break;case 4:t.p=4,i=t.v,e.error=(null===(o=i.response)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.message)||"Не найдено";case 5:return t.p=5,e.loading=!1,t.f(5);case 6:return t.a(2)}},t,null,[[2,4,5,6]])}))()}}},R=N;var $=(0,u.A)(R,v,m,!1,null,"266fb2dc",null);const E=$.exports;var q=function(){var e=this,t=e._self._c;return t("div",{staticClass:"wrap"},[t("h1",[e._v("Admin Login")]),t("form",{on:{submit:function(t){return t.preventDefault(),e.login.apply(null,arguments)}}},[t("label",[e._v("Username "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{required:""},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),t("label",[e._v("Password "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),t("button",{attrs:{type:"submit"}},[e._v("Login")]),e.error?t("div",{staticClass:"error"},[e._v(e._s(e.error))]):e._e()])])},F=[];const L={name:"AdminLogin",data:function(){return{username:"",password:"",error:""}},methods:{login:function(){var e=this;return(0,f.A)((0,p.A)().m(function t(){var n,r,a,o;return(0,p.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return e.error="",t.p=1,t.n=2,_.post("/auth/login",{username:e.username,password:e.password});case 2:n=t.v,r=n.data,localStorage.setItem("token",r.token),e.$router.push("/admin"),t.n=4;break;case 3:t.p=3,o=t.v,e.error=(null===(a=o.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.message)||"Login failed";case 4:return t.a(2)}},t,null,[[1,3]])}))()}}},U=L;var z=(0,u.A)(U,q,F,!1,null,"1baf2ab8",null);const K=z.exports;var T=function(){var e=this,t=e._self._c;return t("div",{staticClass:"wrap"},[t("header",{staticClass:"top"},[t("h1",[e._v("Админка")]),t("div",[t("button",{on:{click:function(t){return e.$router.push("/")}}},[e._v("Сайт")]),t("button",{on:{click:e.logout}},[e._v("Выход")])])]),t("section",{staticClass:"panel"},[t("h2",[e._v("Создать админа")]),t("form",{on:{submit:function(t){return t.preventDefault(),e.createAdmin.apply(null,arguments)}}},[t("label",[e._v("Username "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.adminUsername,expression:"adminUsername"}],attrs:{placeholder:"newadmin",required:""},domProps:{value:e.adminUsername},on:{input:function(t){t.target.composing||(e.adminUsername=t.target.value)}}})]),t("button",{attrs:{type:"submit"}},[e._v("Создать")])]),e.newAdmin?t("div",{staticClass:"note"},[e._v(" Создан админ: "),t("strong",[e._v(e._s(e.newAdmin.username))]),t("br"),e._v(" Пароль (показывается один раз): "),t("code",[e._v(e._s(e.newAdmin.password))])]):e._e(),e.adminError?t("div",{staticClass:"error"},[e._v(e._s(e.adminError))]):e._e()]),t("section",{staticClass:"panel"},[t("h2",[e._v("Автомобили")]),t("CarForm",{attrs:{submitText:e.edited?"Обновить":"Создать",value:e.edited||{},onCancel:e.cancelEdit},on:{submit:e.upsert}}),t("table",{staticClass:"table"},[e._m(0),t("tbody",e._l(e.cars,function(n){return t("tr",{key:n._id},[t("td",[e._v(e._s(n.makeModel))]),t("td",[e._v(e._s(n.year))]),t("td",[e._v(e._s(n.vin))]),t("td",[e._v(e._s(n.invoiceNumber))]),t("td",[e._v(e._s(n.condition))]),t("td",[e._v(e._s(n.location))]),t("td",[t("button",{on:{click:function(t){e.edited=n}}},[e._v("Редакт.")]),t("button",{staticClass:"danger",on:{click:function(t){return e.del(n._id)}}},[e._v("Удалить")])])])}),0)])],1)])},V=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Make/Model")]),t("th",[e._v("Year")]),t("th",[e._v("VIN")]),t("th",[e._v("Invoice")]),t("th",[e._v("Condition")]),t("th",[e._v("Location")]),t("th",[e._v("Действия")])])])}],W=(n(2008),n(3609),n(2489),function(){var e=this,t=e._self._c;return t("form",{on:{submit:function(t){return t.preventDefault(),e.submit.apply(null,arguments)}}},[t("div",{staticClass:"grid"},[t("label",[e._v("Make Model "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.makeModel,expression:"form.makeModel"}],attrs:{required:""},domProps:{value:e.form.makeModel},on:{input:function(t){t.target.composing||e.$set(e.form,"makeModel",t.target.value)}}})]),t("label",[e._v("Year "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.form.year,expression:"form.year",modifiers:{number:!0}}],attrs:{type:"number",min:"1900",required:""},domProps:{value:e.form.year},on:{input:function(t){t.target.composing||e.$set(e.form,"year",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("label",[e._v("VIN "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.vin,expression:"form.vin"}],attrs:{required:""},domProps:{value:e.form.vin},on:{input:function(t){t.target.composing||e.$set(e.form,"vin",t.target.value)}}})]),t("label",[e._v("Invoice # "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.invoiceNumber,expression:"form.invoiceNumber"}],attrs:{required:""},domProps:{value:e.form.invoiceNumber},on:{input:function(t){t.target.composing||e.$set(e.form,"invoiceNumber",t.target.value)}}})]),t("label",[e._v(" Condition "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.form.condition,expression:"form.condition"}],attrs:{required:""},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.$set(e.form,"condition",t.target.multiple?n:n[0])}}},[t("option",{attrs:{value:"in_transit"}},[e._v("in transit")]),t("option",{attrs:{value:"registration"}},[e._v("registration")])])]),t("label",[e._v(" Location "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.form.location,expression:"form.location"}],attrs:{required:""},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.$set(e.form,"location",t.target.multiple?n:n[0])}}},[t("option",{attrs:{value:"warehouse"}},[e._v("warehouse")]),t("option",{attrs:{value:"Khorgos"}},[e._v("Khorgos")]),t("option",{attrs:{value:"Kazakhstan terminal"}},[e._v("Kazakhstan terminal")]),t("option",{attrs:{value:"Kazakhstan-Russian Federation customs post"}},[e._v("Kazakhstan-Russian Federation customs post")]),t("option",{attrs:{value:"Minsk"}},[e._v("Minsk")])])])]),t("div",{staticClass:"actions"},[t("button",{attrs:{type:"submit"}},[e._v(e._s(e.submitText))]),e.onCancel?t("button",{attrs:{type:"button"},on:{click:e.onCancel}},[e._v("Cancel")]):e._e()])])}),Y=[],B=n(5051);const Z={name:"CarForm",props:{value:{type:Object,default:function(){return{}}},onCancel:{type:Function},submitText:{type:String,default:"Save"}},data:function(){return{form:(0,B.A)({},this.value)}},watch:{value:{deep:!0,handler:function(e){this.form=(0,B.A)({},e)}}},methods:{submit:function(){this.$emit("submit",(0,B.A)({},this.form))}}},D=Z;var G=(0,u.A)(D,W,Y,!1,null,"0feab7be",null);const H=G.exports,J={name:"AdminPage",components:{CarForm:H},data:function(){return{cars:[],edited:null,adminUsername:"",newAdmin:null,adminError:""}},created:function(){this.fetchCars()},methods:{logout:function(){localStorage.removeItem("token"),this.$router.push("/admin/login")},fetchCars:function(){var e=this;return(0,f.A)((0,p.A)().m(function t(){var n,r;return(0,p.A)().w(function(t){while(1)switch(t.n){case 0:return t.n=1,_.get("/cars");case 1:n=t.v,r=n.data,e.cars=r;case 2:return t.a(2)}},t)}))()},upsert:function(e){var t=this;return(0,f.A)((0,p.A)().m(function n(){var r,a,o,i,s,u,c;return(0,p.A)().w(function(n){while(1)switch(n.p=n.n){case 0:if(n.p=0,!t.edited||!t.edited._id){n.n=2;break}return n.n=1,_.put("/cars/".concat(t.edited._id),e);case 1:r=n.v,a=r.data,o=t.cars.findIndex(function(e){return e._id===a._id}),t.$set(t.cars,o,a),t.edited=null,n.n=4;break;case 2:return n.n=3,_.post("/cars",e);case 3:i=n.v,s=i.data,t.cars.unshift(s);case 4:n.n=6;break;case 5:n.p=5,c=n.v,alert((null===(u=c.response)||void 0===u||null===(u=u.data)||void 0===u?void 0:u.message)||"Ошибка сохранения");case 6:return n.a(2)}},n,null,[[0,5]])}))()},cancelEdit:function(){this.edited=null},del:function(e){var t=this;return(0,f.A)((0,p.A)().m(function n(){return(0,p.A)().w(function(n){while(1)switch(n.n){case 0:if(confirm("Удалить запись?")){n.n=1;break}return n.a(2);case 1:return n.n=2,_["delete"]("/cars/".concat(e));case 2:t.cars=t.cars.filter(function(t){return t._id!==e});case 3:return n.a(2)}},n)}))()},createAdmin:function(){var e=this;return(0,f.A)((0,p.A)().m(function t(){var n,r,a,o;return(0,p.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return e.adminError="",e.newAdmin=null,t.p=1,t.n=2,_.post("/admins",{username:e.adminUsername});case 2:n=t.v,r=n.data,e.newAdmin=r,e.adminUsername="",t.n=4;break;case 3:t.p=3,o=t.v,e.adminError=(null===(a=o.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.message)||"Ошибка создания админа";case 4:return t.a(2)}},t,null,[[1,3]])}))()}}},Q=J;var X=(0,u.A)(Q,T,V,!1,null,"5b0fc91e",null);const ee=X.exports;function te(){return!!localStorage.getItem("token")}r.Ay.use(d.Ay);var ne=new d.Ay({mode:"history",routes:[{path:"/",component:E},{path:"/admin/login",component:K},{path:"/admin",component:ee,beforeEnter:function(e,t,n){if(!te())return n("/admin/login");n()}},{path:"*",redirect:"/"}]});const re=ne;r.Ay.config.productionTip=!1,new r.Ay({router:re,render:function(e){return e(l)}}).$mount("#app")}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,(()=>{var e=[];n.O=(t,r,a,o)=>{if(!r){var i=1/0;for(l=0;l<e.length;l++){for(var[r,a,o]=e[l],s=!0,u=0;u<r.length;u++)(!1&o||i>=o)&&Object.keys(n.O).every(e=>n.O[e](r[u]))?r.splice(u--,1):(s=!1,o<i&&(i=o));if(s){e.splice(l--,1);var c=a();void 0!==c&&(t=c)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[r,a,o]}})(),(()=>{n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}})(),(()=>{n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{var e={524:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var a,o,[i,s,u]=r,c=0;if(i.some(t=>0!==e[t])){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(u)var l=u(n)}for(t&&t(r);c<i.length;c++)o=i[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(l)},r=self["webpackChunkcar_tracker_client"]=self["webpackChunkcar_tracker_client"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=n.O(void 0,[504],()=>n(366));r=n.O(r)})();
//# sourceMappingURL=app.8c31570a.js.map